<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¨æ—¥æœŸè¿ç»­æ˜¾ç¤ºæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
        }

        .btn {
            padding: 8px 16px;
            border: 2px solid #4a90e2;
            background: white;
            color: #4a90e2;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #4a90e2;
            color: white;
        }

        .btn.active {
            background: #4a90e2;
            color: white;
        }

        .calendar-container {
            padding: 30px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .calendar-header {
            background: #4a90e2;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .calendar-day {
            background: white;
            min-height: 120px;
            padding: 8px;
            position: relative;
            border: 1px solid #e9ecef;
        }

        .calendar-day.other-month {
            background: #f8f9fa;
            color: #6c757d;
        }

        .calendar-day.today {
            background: #fff3cd;
            border-color: #ffc107;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .day-content {
            position: relative;
            height: calc(100% - 25px);
        }

        .content-mark {
            position: absolute;
            background: #4a90e2;
            color: white;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .content-mark:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .span-content-mark {
            position: absolute;
            background: #4a90e2;
            color: white;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .span-content-mark:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 20;
        }

        .info-panel {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .info-panel h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-panel p {
            color: #424242;
            line-height: 1.6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h4 {
            color: #4a90e2;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>è·¨æ—¥æœŸè¿ç»­æ˜¾ç¤ºæ¼”ç¤º</h1>
            <p>å±•ç¤ºä»»åŠ¡åœ¨æ—¥å†ä¸­çš„è¿ç»­æ¡å½¢å›¾æ˜¾ç¤ºæ•ˆæœï¼Œç±»ä¼¼ç”˜ç‰¹å›¾</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>æ˜¾ç¤ºæ¨¡å¼:</label>
                <button class="btn active" onclick="toggleSpanMode('span')">è¿ç»­æ¨¡å¼</button>
                <button class="btn" onclick="toggleSpanMode('single')">å•æ—¥æ¨¡å¼</button>
            </div>
            <div class="control-group">
                <label>å¯¹é½æ–¹å¼:</label>
                <button class="btn" onclick="changeAlignment('left')">å·¦å¯¹é½</button>
                <button class="btn" onclick="changeAlignment('center')">å±…ä¸­</button>
                <button class="btn" onclick="changeAlignment('right')">å³å¯¹é½</button>
            </div>
            <div class="control-group">
                <button class="btn" onclick="addLongTermTask()">æ·»åŠ é•¿æœŸä»»åŠ¡</button>
            </div>
        </div>

        <div class="calendar-container">
            <div class="info-panel">
                <h3>ğŸ¯ è·¨æ—¥æœŸè¿ç»­æ˜¾ç¤ºç‰¹æ€§</h3>
                <p>ä»»åŠ¡ä»å¼€å§‹æ—¥æœŸåˆ°ç»“æŸæ—¥æœŸå½¢æˆè¿ç»­çš„æ¡å½¢å›¾ï¼Œè·¨è¶Šå¤šä¸ªæ—¥æœŸæ ¼å­ã€‚å½“ä»»åŠ¡è·¨è¶Šå¤šå‘¨æ—¶ï¼Œä¼šåœ¨æ¯å‘¨æ˜¾ç¤ºå¯¹åº”çš„éƒ¨åˆ†ï¼Œä½†è§†è§‰ä¸Šä¿æŒè¿ç»­æ€§ã€‚è¿™ç§æ˜¾ç¤ºæ–¹å¼ç±»ä¼¼ç”˜ç‰¹å›¾ï¼Œèƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºä»»åŠ¡çš„æ—¶é—´è·¨åº¦ã€‚</p>
            </div>

            <div class="calendar-grid" id="calendar">
                <!-- æ—¥å†å¤´éƒ¨ -->
                <div class="calendar-header">æ—¥</div>
                <div class="calendar-header">ä¸€</div>
                <div class="calendar-header">äºŒ</div>
                <div class="calendar-header">ä¸‰</div>
                <div class="calendar-header">å››</div>
                <div class="calendar-header">äº”</div>
                <div class="calendar-header">å…­</div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <h4>ğŸ“… æ€»ä»»åŠ¡æ•°</h4>
                    <div class="stat-value" id="totalTasks">0</div>
                </div>
                <div class="stat-card">
                    <h4>ğŸ”„ è·¨æ—¥æœŸä»»åŠ¡</h4>
                    <div class="stat-value" id="spanTasks">0</div>
                </div>
                <div class="stat-card">
                    <h4>ğŸ“Š å¹³å‡è·¨åº¦</h4>
                    <div class="stat-value" id="avgSpan">0</div>
                </div>
                <div class="stat-card">
                    <h4>ğŸ“ˆ æœ€å¤§è·¨åº¦</h4>
                    <div class="stat-value" id="maxSpan">0</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç¤ºä¾‹æ•°æ® - è·¨æ—¥æœŸä»»åŠ¡
        const demoRanges = [
            {
                code: 'project-alpha',
                name: 'é¡¹ç›®Alphaå¼€å‘',
                startDate: '2025-08-01',
                endDate: '2025-08-08',
                color: '#fff',
                bgColor: '#4a90e2',
                content: 'é¡¹ç›®Alpha - æ ¸å¿ƒåŠŸèƒ½å¼€å‘'
            },
            {
                code: 'design-phase',
                name: 'è®¾è®¡é˜¶æ®µ',
                startDate: '2025-08-05',
                endDate: '2025-08-12',
                color: '#fff',
                bgColor: '#7b68ee',
                content: 'UI/UXè®¾è®¡ä¸åŸå‹åˆ¶ä½œ'
            },
            {
                code: 'testing-phase',
                name: 'æµ‹è¯•é˜¶æ®µ',
                startDate: '2025-08-10',
                endDate: '2025-08-18',
                color: '#fff',
                bgColor: '#32cd32',
                content: 'åŠŸèƒ½æµ‹è¯•ä¸è´¨é‡ä¿è¯'
            },
            {
                code: 'deployment',
                name: 'éƒ¨ç½²ä¸Šçº¿',
                startDate: '2025-08-15',
                endDate: '2025-08-22',
                color: '#fff',
                bgColor: '#ff6347',
                content: 'ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ä¸ç›‘æ§'
            },
            {
                code: 'cross-month',
                name: 'è·¨æœˆé¡¹ç›®',
                startDate: '2025-08-25',
                endDate: '2025-09-05',
                color: '#fff',
                bgColor: '#ff9500',
                content: 'è·¨æœˆé•¿æœŸé¡¹ç›®'
            }
        ];

        // å½“å‰é…ç½®
        let currentSpanMode = 'span';
        let currentAlignment = 'left';
        let ranges = [...demoRanges];

        // è®¡ç®—è·¨æ—¥æœŸä»»åŠ¡çš„è¿ç»­æ˜¾ç¤º
        function calculateSpanDisplay(range) {
            const startDate = new Date(range.startDate);
            const endDate = new Date(range.endDate);
            const spans = [];

            // æŒ‰å‘¨åˆ†ç»„è®¡ç®—
            let currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const weekStart = new Date(currentDate);
                weekStart.setDate(weekStart.getDate() - weekStart.getDay()); // å‘¨æ—¥

                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6); // å‘¨å…­

                const spanStart = new Date(Math.max(currentDate.getTime(), weekStart.getTime()));
                const spanEnd = new Date(Math.min(endDate.getTime(), weekEnd.getTime()));

                if (spanStart <= spanEnd) {
                    spans.push({
                        startDate: spanStart.toISOString().split('T')[0],
                        endDate: spanEnd.toISOString().split('T')[0],
                        isFirstWeek: currentDate.getTime() === startDate.getTime(),
                        isLastWeek: spanEnd.getTime() === endDate.getTime()
                    });
                }

                // ç§»åŠ¨åˆ°ä¸‹ä¸€å‘¨
                currentDate = new Date(weekEnd);
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return spans;
        }

        // ç”Ÿæˆæ—¥å†
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const existingDays = calendar.querySelectorAll('.calendar-day');
            
            // æ¸…é™¤ç°æœ‰å†…å®¹æ ‡è®°ï¼Œä¿ç•™æ—¥æœŸç»“æ„
            existingDays.forEach(day => {
                const dayContent = day.querySelector('.day-content');
                if (dayContent) {
                    dayContent.innerHTML = '';
                }
            });

            // å¦‚æœæ²¡æœ‰æ—¥æœŸç»“æ„ï¼Œåˆ›å»ºæ—¥å†
            if (existingDays.length === 0) {
                calendar.innerHTML = `
                    <div class="calendar-header">æ—¥</div>
                    <div class="calendar-header">ä¸€</div>
                    <div class="calendar-header">äºŒ</div>
                    <div class="calendar-header">ä¸‰</div>
                    <div class="calendar-header">å››</div>
                    <div class="calendar-header">äº”</div>
                    <div class="calendar-header">å…­</div>
                `;

                // ç”Ÿæˆ2025å¹´8æœˆçš„æ—¥å†
                const year = 2025;
                const month = 7; // 8æœˆ (0-based)
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                const endDate = new Date(lastDay);
                endDate.setDate(endDate.getDate() + (6 - lastDay.getDay()));

                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.dataset.date = d.toISOString().split('T')[0];
                    
                    if (d.getMonth() !== month) {
                        dayElement.classList.add('other-month');
                    }
                    
                    const today = new Date();
                    if (d.toDateString() === today.toDateString()) {
                        dayElement.classList.add('today');
                    }
                    
                    dayElement.innerHTML = `
                        <div class="day-number">${d.getDate()}</div>
                        <div class="day-content"></div>
                    `;
                    
                    calendar.appendChild(dayElement);
                }
            }

            // æ·»åŠ ä»»åŠ¡æ˜¾ç¤º
            ranges.forEach((range, rangeIndex) => {
                if (currentSpanMode === 'span') {
                    // è¿ç»­æ¨¡å¼ï¼šç”Ÿæˆè·¨æ—¥æœŸè¿ç»­æ¡å½¢å›¾
                    const spans = calculateSpanDisplay(range);
                    
                    spans.forEach((span, spanIndex) => {
                        const startDate = new Date(span.startDate);
                        const endDate = new Date(span.endDate);
                        const dayCount = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                        
                        // åœ¨èµ·å§‹æ—¥æœŸåˆ›å»ºè·¨æ—¥æœŸæ ‡è®°
                        const startDayElement = document.querySelector(`[data-date="${span.startDate}"]`);
                        if (startDayElement) {
                            const dayContent = startDayElement.querySelector('.day-content');
                            const spanElement = document.createElement('div');
                            spanElement.className = 'span-content-mark';
                            spanElement.textContent = range.content || range.name;
                            
                            // è®¡ç®—å®½åº¦å’Œä½ç½®
                            const cellWidth = startDayElement.offsetWidth || 140;
                            const spanWidth = cellWidth * dayCount + (dayCount - 1); // åŒ…æ‹¬é—´éš™
                            
                            spanElement.style.cssText = `
                                position: absolute;
                                left: 0;
                                top: ${30 + rangeIndex * 25}px;
                                width: ${spanWidth}px;
                                height: 20px;
                                background: ${range.bgColor || '#4a90e2'};
                                color: ${range.color || '#fff'};
                                font-size: 11px;
                                line-height: 20px;
                                text-align: ${currentAlignment};
                                border-radius: 4px;
                                padding: 0 8px;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                z-index: ${10 + rangeIndex};
                                overflow: hidden;
                                white-space: nowrap;
                                text-overflow: ellipsis;
                            `;

                            // è·¨å‘¨è¾¹æ¡†æ ·å¼
                            if (spans.length > 1) {
                                if (span.isFirstWeek) {
                                    spanElement.style.borderRight = '2px dashed rgba(255,255,255,0.5)';
                                } else if (span.isLastWeek) {
                                    spanElement.style.borderLeft = '2px dashed rgba(255,255,255,0.5)';
                                } else {
                                    spanElement.style.borderLeft = '2px dashed rgba(255,255,255,0.5)';
                                    spanElement.style.borderRight = '2px dashed rgba(255,255,255,0.5)';
                                    spanElement.style.opacity = '0.9';
                                }
                            }
                            
                            dayContent.appendChild(spanElement);
                        }
                    });
                } else {
                    // å•æ—¥æ¨¡å¼ï¼šåœ¨æ¯ä¸ªæ—¥æœŸå•ç‹¬æ˜¾ç¤º
                    const startDate = new Date(range.startDate);
                    const endDate = new Date(range.endDate);
                    
                    for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                        const dateStr = d.toISOString().split('T')[0];
                        const dayElement = document.querySelector(`[data-date="${dateStr}"]`);
                        
                        if (dayElement) {
                            const dayContent = dayElement.querySelector('.day-content');
                            const contentElement = document.createElement('div');
                            contentElement.className = 'content-mark';
                            contentElement.textContent = range.content || range.name;
                            
                            contentElement.style.cssText = `
                                position: absolute;
                                left: 5px;
                                right: 5px;
                                top: ${30 + rangeIndex * 25}px;
                                height: 20px;
                                background: ${range.bgColor || '#4a90e2'};
                                color: ${range.color || '#fff'};
                                font-size: 11px;
                                line-height: 20px;
                                text-align: ${currentAlignment};
                                border-radius: 4px;
                                padding: 0 8px;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                z-index: ${10 + rangeIndex};
                                overflow: hidden;
                                white-space: nowrap;
                                text-overflow: ellipsis;
                            `;
                            
                            dayContent.appendChild(contentElement);
                        }
                    }
                }
            });

            updateStats();
        }

        // åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼
        function toggleSpanMode(mode) {
            currentSpanMode = mode;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.controls .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            generateCalendar();
        }

        // æ”¹å˜å¯¹é½æ–¹å¼
        function changeAlignment(alignment) {
            currentAlignment = alignment;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const alignmentButtons = document.querySelectorAll('.controls .control-group:nth-child(2) .btn');
            alignmentButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            generateCalendar();
        }

        // æ·»åŠ é•¿æœŸä»»åŠ¡
        function addLongTermTask() {
            const newTask = {
                code: `task-${Date.now()}`,
                name: 'æ–°å¢é•¿æœŸä»»åŠ¡',
                startDate: '2025-08-20',
                endDate: '2025-08-30',
                color: '#fff',
                bgColor: '#' + Math.floor(Math.random()*16777215).toString(16),
                content: 'åŠ¨æ€æ·»åŠ çš„é•¿æœŸä»»åŠ¡'
            };
            
            ranges.push(newTask);
            generateCalendar();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const totalTasks = ranges.length;
            const spanTasks = ranges.filter(range => {
                const start = new Date(range.startDate);
                const end = new Date(range.endDate);
                return (end - start) / (1000 * 60 * 60 * 24) > 0;
            }).length;
            
            const spans = ranges.map(range => {
                const start = new Date(range.startDate);
                const end = new Date(range.endDate);
                return Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            });
            
            const avgSpan = spans.length > 0 ? Math.round(spans.reduce((a, b) => a + b, 0) / spans.length) : 0;
            const maxSpan = spans.length > 0 ? Math.max(...spans) : 0;

            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('spanTasks').textContent = spanTasks;
            document.getElementById('avgSpan').textContent = avgSpan + 'å¤©';
            document.getElementById('maxSpan').textContent = maxSpan + 'å¤©';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar();
        });
    </script>
</body>
</html>