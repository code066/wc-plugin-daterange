<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跨日期连续显示演示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
        }

        .btn {
            padding: 8px 16px;
            border: 2px solid #4a90e2;
            background: white;
            color: #4a90e2;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #4a90e2;
            color: white;
        }

        .btn.active {
            background: #4a90e2;
            color: white;
        }

        .calendar-container {
            padding: 30px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .calendar-header {
            background: #4a90e2;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .calendar-day {
            background: white;
            min-height: 120px;
            padding: 8px;
            position: relative;
            border: 1px solid #e9ecef;
        }

        .calendar-day.other-month {
            background: #f8f9fa;
            color: #6c757d;
        }

        .calendar-day.today {
            background: #fff3cd;
            border-color: #ffc107;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .day-content {
            position: relative;
            height: calc(100% - 25px);
        }

        .content-mark {
            position: absolute;
            background: #4a90e2;
            color: white;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .content-mark:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .span-content-mark {
            position: absolute;
            background: #4a90e2;
            color: white;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .span-content-mark:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 20;
        }

        .info-panel {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .info-panel h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-panel p {
            color: #424242;
            line-height: 1.6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h4 {
            color: #4a90e2;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>跨日期连续显示演示</h1>
            <p>展示任务在日历中的连续条形图显示效果，类似甘特图</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>显示模式:</label>
                <button class="btn active" onclick="toggleSpanMode('span')">连续模式</button>
                <button class="btn" onclick="toggleSpanMode('single')">单日模式</button>
            </div>
            <div class="control-group">
                <label>对齐方式:</label>
                <button class="btn" onclick="changeAlignment('left')">左对齐</button>
                <button class="btn" onclick="changeAlignment('center')">居中</button>
                <button class="btn" onclick="changeAlignment('right')">右对齐</button>
            </div>
            <div class="control-group">
                <button class="btn" onclick="addLongTermTask()">添加长期任务</button>
            </div>
        </div>

        <div class="calendar-container">
            <div class="info-panel">
                <h3>🎯 跨日期连续显示特性</h3>
                <p>任务从开始日期到结束日期形成连续的条形图，跨越多个日期格子。当任务跨越多周时，会在每周显示对应的部分，但视觉上保持连续性。这种显示方式类似甘特图，能够清晰地展示任务的时间跨度。</p>
            </div>

            <div class="calendar-grid" id="calendar">
                <!-- 日历头部 -->
                <div class="calendar-header">日</div>
                <div class="calendar-header">一</div>
                <div class="calendar-header">二</div>
                <div class="calendar-header">三</div>
                <div class="calendar-header">四</div>
                <div class="calendar-header">五</div>
                <div class="calendar-header">六</div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <h4>📅 总任务数</h4>
                    <div class="stat-value" id="totalTasks">0</div>
                </div>
                <div class="stat-card">
                    <h4>🔄 跨日期任务</h4>
                    <div class="stat-value" id="spanTasks">0</div>
                </div>
                <div class="stat-card">
                    <h4>📊 平均跨度</h4>
                    <div class="stat-value" id="avgSpan">0</div>
                </div>
                <div class="stat-card">
                    <h4>📈 最大跨度</h4>
                    <div class="stat-value" id="maxSpan">0</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 示例数据 - 跨日期任务
        const demoRanges = [
            {
                code: 'project-alpha',
                name: '项目Alpha开发',
                startDate: '2025-08-01',
                endDate: '2025-08-08',
                color: '#fff',
                bgColor: '#4a90e2',
                content: '项目Alpha - 核心功能开发'
            },
            {
                code: 'design-phase',
                name: '设计阶段',
                startDate: '2025-08-05',
                endDate: '2025-08-12',
                color: '#fff',
                bgColor: '#7b68ee',
                content: 'UI/UX设计与原型制作'
            },
            {
                code: 'testing-phase',
                name: '测试阶段',
                startDate: '2025-08-10',
                endDate: '2025-08-18',
                color: '#fff',
                bgColor: '#32cd32',
                content: '功能测试与质量保证'
            },
            {
                code: 'deployment',
                name: '部署上线',
                startDate: '2025-08-15',
                endDate: '2025-08-22',
                color: '#fff',
                bgColor: '#ff6347',
                content: '生产环境部署与监控'
            },
            {
                code: 'cross-month',
                name: '跨月项目',
                startDate: '2025-08-25',
                endDate: '2025-09-05',
                color: '#fff',
                bgColor: '#ff9500',
                content: '跨月长期项目'
            }
        ];

        // 当前配置
        let currentSpanMode = 'span';
        let currentAlignment = 'left';
        let ranges = [...demoRanges];

        // 计算跨日期任务的连续显示
        function calculateSpanDisplay(range) {
            const startDate = new Date(range.startDate);
            const endDate = new Date(range.endDate);
            const spans = [];

            // 按周分组计算
            let currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const weekStart = new Date(currentDate);
                weekStart.setDate(weekStart.getDate() - weekStart.getDay()); // 周日

                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6); // 周六

                const spanStart = new Date(Math.max(currentDate.getTime(), weekStart.getTime()));
                const spanEnd = new Date(Math.min(endDate.getTime(), weekEnd.getTime()));

                if (spanStart <= spanEnd) {
                    spans.push({
                        startDate: spanStart.toISOString().split('T')[0],
                        endDate: spanEnd.toISOString().split('T')[0],
                        isFirstWeek: currentDate.getTime() === startDate.getTime(),
                        isLastWeek: spanEnd.getTime() === endDate.getTime()
                    });
                }

                // 移动到下一周
                currentDate = new Date(weekEnd);
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return spans;
        }

        // 生成日历
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const existingDays = calendar.querySelectorAll('.calendar-day');
            
            // 清除现有内容标记，保留日期结构
            existingDays.forEach(day => {
                const dayContent = day.querySelector('.day-content');
                if (dayContent) {
                    dayContent.innerHTML = '';
                }
            });

            // 如果没有日期结构，创建日历
            if (existingDays.length === 0) {
                calendar.innerHTML = `
                    <div class="calendar-header">日</div>
                    <div class="calendar-header">一</div>
                    <div class="calendar-header">二</div>
                    <div class="calendar-header">三</div>
                    <div class="calendar-header">四</div>
                    <div class="calendar-header">五</div>
                    <div class="calendar-header">六</div>
                `;

                // 生成2025年8月的日历
                const year = 2025;
                const month = 7; // 8月 (0-based)
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                const endDate = new Date(lastDay);
                endDate.setDate(endDate.getDate() + (6 - lastDay.getDay()));

                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.dataset.date = d.toISOString().split('T')[0];
                    
                    if (d.getMonth() !== month) {
                        dayElement.classList.add('other-month');
                    }
                    
                    const today = new Date();
                    if (d.toDateString() === today.toDateString()) {
                        dayElement.classList.add('today');
                    }
                    
                    dayElement.innerHTML = `
                        <div class="day-number">${d.getDate()}</div>
                        <div class="day-content"></div>
                    `;
                    
                    calendar.appendChild(dayElement);
                }
            }

            // 添加任务显示
            ranges.forEach((range, rangeIndex) => {
                if (currentSpanMode === 'span') {
                    // 连续模式：生成跨日期连续条形图
                    const spans = calculateSpanDisplay(range);
                    
                    spans.forEach((span, spanIndex) => {
                        const startDate = new Date(span.startDate);
                        const endDate = new Date(span.endDate);
                        const dayCount = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                        
                        // 在起始日期创建跨日期标记
                        const startDayElement = document.querySelector(`[data-date="${span.startDate}"]`);
                        if (startDayElement) {
                            const dayContent = startDayElement.querySelector('.day-content');
                            const spanElement = document.createElement('div');
                            spanElement.className = 'span-content-mark';
                            spanElement.textContent = range.content || range.name;
                            
                            // 计算宽度和位置
                            const cellWidth = startDayElement.offsetWidth || 140;
                            const spanWidth = cellWidth * dayCount + (dayCount - 1); // 包括间隙
                            
                            spanElement.style.cssText = `
                                position: absolute;
                                left: 0;
                                top: ${30 + rangeIndex * 25}px;
                                width: ${spanWidth}px;
                                height: 20px;
                                background: ${range.bgColor || '#4a90e2'};
                                color: ${range.color || '#fff'};
                                font-size: 11px;
                                line-height: 20px;
                                text-align: ${currentAlignment};
                                border-radius: 4px;
                                padding: 0 8px;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                z-index: ${10 + rangeIndex};
                                overflow: hidden;
                                white-space: nowrap;
                                text-overflow: ellipsis;
                            `;

                            // 跨周边框样式
                            if (spans.length > 1) {
                                if (span.isFirstWeek) {
                                    spanElement.style.borderRight = '2px dashed rgba(255,255,255,0.5)';
                                } else if (span.isLastWeek) {
                                    spanElement.style.borderLeft = '2px dashed rgba(255,255,255,0.5)';
                                } else {
                                    spanElement.style.borderLeft = '2px dashed rgba(255,255,255,0.5)';
                                    spanElement.style.borderRight = '2px dashed rgba(255,255,255,0.5)';
                                    spanElement.style.opacity = '0.9';
                                }
                            }
                            
                            dayContent.appendChild(spanElement);
                        }
                    });
                } else {
                    // 单日模式：在每个日期单独显示
                    const startDate = new Date(range.startDate);
                    const endDate = new Date(range.endDate);
                    
                    for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                        const dateStr = d.toISOString().split('T')[0];
                        const dayElement = document.querySelector(`[data-date="${dateStr}"]`);
                        
                        if (dayElement) {
                            const dayContent = dayElement.querySelector('.day-content');
                            const contentElement = document.createElement('div');
                            contentElement.className = 'content-mark';
                            contentElement.textContent = range.content || range.name;
                            
                            contentElement.style.cssText = `
                                position: absolute;
                                left: 5px;
                                right: 5px;
                                top: ${30 + rangeIndex * 25}px;
                                height: 20px;
                                background: ${range.bgColor || '#4a90e2'};
                                color: ${range.color || '#fff'};
                                font-size: 11px;
                                line-height: 20px;
                                text-align: ${currentAlignment};
                                border-radius: 4px;
                                padding: 0 8px;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                z-index: ${10 + rangeIndex};
                                overflow: hidden;
                                white-space: nowrap;
                                text-overflow: ellipsis;
                            `;
                            
                            dayContent.appendChild(contentElement);
                        }
                    }
                }
            });

            updateStats();
        }

        // 切换显示模式
        function toggleSpanMode(mode) {
            currentSpanMode = mode;
            
            // 更新按钮状态
            document.querySelectorAll('.controls .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            generateCalendar();
        }

        // 改变对齐方式
        function changeAlignment(alignment) {
            currentAlignment = alignment;
            
            // 更新按钮状态
            const alignmentButtons = document.querySelectorAll('.controls .control-group:nth-child(2) .btn');
            alignmentButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            generateCalendar();
        }

        // 添加长期任务
        function addLongTermTask() {
            const newTask = {
                code: `task-${Date.now()}`,
                name: '新增长期任务',
                startDate: '2025-08-20',
                endDate: '2025-08-30',
                color: '#fff',
                bgColor: '#' + Math.floor(Math.random()*16777215).toString(16),
                content: '动态添加的长期任务'
            };
            
            ranges.push(newTask);
            generateCalendar();
        }

        // 更新统计信息
        function updateStats() {
            const totalTasks = ranges.length;
            const spanTasks = ranges.filter(range => {
                const start = new Date(range.startDate);
                const end = new Date(range.endDate);
                return (end - start) / (1000 * 60 * 60 * 24) > 0;
            }).length;
            
            const spans = ranges.map(range => {
                const start = new Date(range.startDate);
                const end = new Date(range.endDate);
                return Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            });
            
            const avgSpan = spans.length > 0 ? Math.round(spans.reduce((a, b) => a + b, 0) / spans.length) : 0;
            const maxSpan = spans.length > 0 ? Math.max(...spans) : 0;

            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('spanTasks').textContent = spanTasks;
            document.getElementById('avgSpan').textContent = avgSpan + '天';
            document.getElementById('maxSpan').textContent = maxSpan + '天';
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar();
        });
    </script>
</body>
</html>